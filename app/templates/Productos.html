{% extends "layaout.html" %}

{% block content %}
<div class="container-fluid p-0">
	<h1 class="h3 mb-3">Gestión de Inventario</h1>

	<!-- Formulario para agregar nueva marca -->
	<form action="{{ url_for('producto.agregar_marca') }}" method="POST" class="d-flex mt-2 mb-4">
		<input name="nueva_marca" class="form-control me-2" placeholder="Nueva marca" required>
		<button class="btn btn-success" type="submit">Agregar Marca</button>
	</form>

	<form action="{{ url_for('producto.agregar_proveedor') }}" method="POST" class="d-flex mt-2 mb-4">
	<input name="nuevo_proveedor" class="form-control me-2" placeholder="Nuevo proveedor" required>
	<button class="btn btn-success" type="submit">Agregar Proveedor</button>
	</form>


	<!-- Formulario para agregar producto -->
	<div class="card mb-4">
		<div class="card-header">
			<h5 class="card-title">Agregar Producto</h5>
		</div>
		<div class="card-body">
			<form action="{{ url_for('producto.index') }}" method="POST">
				<div class="row mb-3">
					<div class="col-md-6">
						<label for="descripcion">Descripción</label>
						<input name="descripcion" id="descripcion" class="form-control" required>
					</div>
					<div class="col-md-6">
						<label for="sku">SKU</label>
						<div class="input-group">
							<input id="sku" name="sku" class="form-control" readonly>
							<button type="button" class="btn btn-outline-secondary" onclick="generarSKU()">Generar</button>
						</div>
					</div>
				</div>

				<div class="row mb-3">
					<div class="col-md-6">
						<label>Marca</label>
						<select name="marca" class="form-select">
							<option value="" selected disabled>Seleccionar</option>
							{% for id, nombre in marcas %}
								<option value="{{ id }}">{{ nombre }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="col-md-6">
						<label>Proveedor</label>
						<select name="proveedor" class="form-select">
							<option value="" selected disabled>Seleccionar</option> 
							{% for id, nombre in proveedores %}
								<option value="{{ id }}">{{ nombre }}</option>
							{% endfor %}
						</select>
					</div>
				</div>

				<div class="row mb-3">
					<div class="col-md-6">
						<label>División</label>
						<select name="division" class="form-select">
							<option value="" selected disabled>Seleccionar</option> 
							<option value="PGC-COMESTIBLE">PGC-COMESTIBLE</option>
							<option value="PGC-NO COMESTIBLE">PGC-NO COMESTIBLE</option>
						</select>
					</div>
					<div class="col-md-6">
						<label>Estado</label>
						<select name="estado" class="form-select">
							<option value="" selected disabled>Seleccionar</option> 
							<option value="activo">Activo</option>
							<option value="inactivo">Inactivo</option>
						</select>
					</div>
				</div>

				<div class="row mb-3">
					<div class="col-md-6">
						<label>OH Disponible</label>
						<input name="oh_disponible" type="number" class="form-control" value="0">
					</div>
					<div class="col-md-6">
						<label>Nuevo OH</label>
						<input name="nuevo_oh" type="number" class="form-control" value="0">
					</div>
				</div>

				<div class="text-end">
					<button class="btn btn-primary" type="submit">Agregar Producto</button>
				</div>
			</form>
		</div>
	</div>

	<!-- Tabla de productos -->
	<div class="card">
		<div class="card-header">
			<h5 class="card-title">Inventario Actual</h5>
		</div>
		<div class="card-body table-responsive">
			<table class="table table-striped table-bordered align-middle">
				<thead class="table-dark text-center">
					<tr>
						<th>ID</th>
						<th>Descripción</th>
						<th>SKU</th>
						<th>Marca</th>
						<th>Proveedor</th>
						<th>División</th>
						<th>Estado</th>
						<th>OH</th>
						<th>Nuevo OH</th>
					</tr>
				</thead>
				<tbody>
					{% for p in productos %}
					<tr>
						<td>{{ p[0] }}</td>
						<td>{{ p[1] }}</td>
						<td>{{ p[2] }}</td>
						<td>{{ p[3] }}</td>
						<td>{{ p[4] }}</td>
						<td>{{ p[5] }}</td>
						<td>{{ 'Activo' if p[6] else 'Inactivo' }}</td>
						<td>{{ p[7] }}</td>
						<td>{{ p[8] }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{% endblock %}

{% block scripts %}	
<script>
	function generarSKU() {
		const sku = Math.floor(10000000 + Math.random() * 90000000);
		document.getElementById('sku').value = sku;
	}
</script>
{% endblock %}